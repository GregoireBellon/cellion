name: On push

on:
  push:
    branches: ["main", "feat/cd"]

jobs:
  test-front:
    uses: ./test-front.yml

  test-back:
    uses: ./test-back.yml

  publish-front:
    needs: test-front
    uses: ./publish-docker.yml
    with:
      context: "front"
      file: "front/docker/Dockerfile"
      image-name: "${{github.repository}}-front"

  publish-back:
    needs: test-back
    uses: ./publish-docker.yml
    with:
      context: "back"
      file: "back/docker/Dockerfile"
      image-name: "${{github.repository}}-front"
