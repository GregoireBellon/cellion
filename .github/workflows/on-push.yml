name: On push

on:
  push:
    branches: ["main", "feat/cd"]

jobs:
  permissions:
    contents: read
    packages: write
    attestations: write

  test-front:
    uses: ./.github/workflows/test-front.yml

  test-back:
    uses: ./.github/workflows/test-back.yml

  publish-front:
    needs: test-front
    uses: ./.github/workflows/publish-docker.yml
    with:
      context: "front"
      file: "front/docker/Dockerfile"
      image-name: "${{github.repository}}-front"

  publish-back:
    needs: test-back
    uses: ./.github/workflows/publish-docker.yml
    with:
      context: "back"
      file: "back/docker/Dockerfile"
      image-name: "${{github.repository}}-back"
